<!DOCTYPE html>
<html lang="tg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeWay TJ ‚Äî –ú–∞–≥–∞–∑–∏–Ω</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
h1 { text-align: center; color: #333; }
.product { background: #fff; padding: 10px; margin-bottom: 10px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
button { background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }
button:hover { background: #0056b3; }
.hidden { display: none; }
.cart { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 6px rgba(0,0,0,0.2); }
</style>
</head>
<body>

<h1>üõç TradeWay TJ</h1>
<div id="shop"></div>

<button onclick="openCart()">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>

<div id="cart" class="cart hidden">
  <h3>üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
  <div id="cart-items"></div>
  <p><b>–ò—Ç–æ–≥–æ:</b> <span id="total">0</span> —Å–æ–º–æ–Ω”£</p>

  <input type="text" id="name" placeholder="–ù–æ–º"><br><br>
  <input type="text" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"><br><br>
  <input type="text" id="address" placeholder="–°—É—Ä–æ“ì–∞"><br><br>

  <button onclick="sendOrder()">üì¶ –§–∞—Ä–º–æ–∏—à</button>
  <button onclick="closeCart()">‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç</button>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbydkrOnh6EGUB89wrf3xo8y1hg_6nDJyOAwCCl4yFmk7ZtQFbBbv32C9APuSfJoyJGr/exec";
let cart = [];

async function loadProducts() {
  try {
    const res = await fetch(GAS_URL, { headers: { "Accept": "application/json" } });
    let data;
    try { data = await res.json(); } 
    catch { data = JSON.parse(await res.text()); }

    const shop = document.getElementById("shop");
    shop.innerHTML = "";
    data.forEach(p => {
      shop.innerHTML += `
        <div class="product">
          <b>${p.name}</b><br>
          –ù–∞—Ä—Ö: ${p.price} —Å–æ–º–æ–Ω”£<br>
          <button onclick="addToCart('${p.name}', ${p.price})">‚ûï –°–∞–±–∞–¥</button>
        </div>`;
    });
  } catch (e) {
    alert("–•–∞—Ç–æ “≥–∞–Ω–≥–æ–º–∏ –±–æ—Ä–∫—É–Ω”£: " + e.message);
  }
}

function addToCart(name, price) {
  cart.push({ name, price });
  alert(`${name} –±–∞ —Å–∞–±–∞–¥ –∏–ª–æ–≤–∞ —à—É–¥!`);
}

function openCart() {
  document.getElementById("cart").classList.remove("hidden");
  document.getElementById("shop").classList.add("hidden");
  updateCart();
}

function closeCart() {
  document.getElementById("cart").classList.add("hidden");
  document.getElementById("shop").classList.remove("hidden");
}

function updateCart() {
  const items = document.getElementById("cart-items");
  items.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    total += item.price;
    items.innerHTML += `<div>${item.name} ‚Äî ${item.price} —Å–æ–º–æ–Ω”£ <button onclick="removeItem(${i})">‚ùå</button></div>`;
  });
  document.getElementById("total").innerText = total;
}

function removeItem(i) {
  cart.splice(i, 1);
  updateCart();
}

async function sendOrder() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const total = document.getElementById("total").innerText;

  if (!name || !phone || cart.length === 0) {
    alert("–õ—É—Ç—Ñ–∞–Ω –º–∞—ä–ª—É–º–æ—Ç—Ä–æ –ø—É—Ä –∫—É–Ω–µ–¥."); 
    return;
  }

  const payload = {
    type: "order",
    customer: { name, phone, address },
    items: cart,
    total: Number(total),
    currency: "—Å–æ–º–æ–Ω”£"
  };

  try {
    await fetch(GAS_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload)
    });
    alert("‚úÖ –§–∞—Ä–º–æ–∏—à —Ñ–∏—Ä–∏—Å—Ç–æ–¥–∞ —à—É–¥!");
    cart = [];
    closeCart();
  } catch (e) {
    alert("‚ùå –•–∞—Ç–æ–≥”£: " + e.message);
  }
}

loadProducts();
</script>
</body>
</html>
