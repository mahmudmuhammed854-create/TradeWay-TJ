<!DOCTYPE html>
<html lang="tg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeWay TJ ‚Äî –ú–∞–≥–æ–∑–∞–∏ –æ–Ω–ª–∞–π–Ω</title>
<style>
body { font-family: Arial, sans-serif; background: #f7f8fa; margin: 0; padding: 0; }
header { background: #007bff; color: #fff; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; }
.container { padding: 15px; }
.category-list, .product-list, .cart { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
.category { background: #e9ecef; padding: 10px; border-radius: 8px; margin: 5px 0; cursor: pointer; transition: 0.3s; }
.category:hover { background: #ced4da; }
button { background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }
button:hover { background: #0056b3; }
.hidden { display: none; }
.cart-item { margin-bottom: 5px; }
input { width: 90%; padding: 8px; margin: 5px 0; border-radius: 6px; border: 1px solid #ccc; }
</style>
</head>
<body>

<header>üõç TradeWay TJ</header>

<div class="container">

  <!-- –†”Ø–π—Ö–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è“≥–æ -->
  <div id="categories" class="category-list"></div>

  <!-- –ú–∞“≥—Å—É–ª–æ—Ç“≥–æ -->
  <div id="products" class="product-list hidden"></div>

  <!-- –°–∞–±–∞–¥ -->
  <div id="cart" class="cart hidden">
    <h3>üõí –°–∞–±–∞–¥</h3>
    <div id="cart-items"></div>
    <p><b>“≤–∞–º–∞–≥”£:</b> <span id="total">0</span> —Å–æ–º–æ–Ω”£</p>

    <input type="text" id="name" placeholder="–ù–æ–º"><br>
    <input type="text" id="phone" placeholder="–†–∞“õ–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω"><br>
    <input type="text" id="address" placeholder="–°—É—Ä–æ“ì–∞"><br>

    <button onclick="sendOrder()">üì¶ –§–∞—Ä–º–æ–∏—à –¥–æ–¥–∞–Ω</button>
    <button onclick="closeCart()">‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç</button>
  </div>

  <!-- üåü –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª -->
  <div id="admin" class="product-list hidden">
    <h3>‚ûï –ò–ª–æ–≤–∞–∏ –º–æ–ª–∏ –Ω–∞–≤</h3>
    <input id="newCat" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è"><br>
    <input id="newName" placeholder="–ù–æ–º–∏ –º–æ–ª"><br>
    <input id="newPrice" type="number" placeholder="–ù–∞—Ä—Ö (—Å–æ–º–æ–Ω”£)"><br>
    <button onclick="addProduct()">üíæ –°–∞–±—Ç</button>
    <button onclick="backToCategories()">‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç</button>
  </div>

</div>

<footer style="text-align:center;padding:10px;">
  <button onclick="openCart()">üõí –°–∞–±–∞–¥</button>
  <button onclick="openAdmin()">üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª</button>
</footer>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbw1CLlk0akY9UzFrMdtDEDhkFK5b2gNPdCxXwe2-MmprJe_Se9LBXk3Iy1p_akenj7d/exec";

// –ú–∞—ä–ª—É–º–æ—Ç–∏ –Ω–∞–º—É–Ω–∞–≤”£ (–∞–≥–∞—Ä –∞–∑ Google Sheets –Ω–∞—Ö–æ“≥–∞–¥ –≥–∏—Ä–∏—Ñ—Ç)
const categories = {
  "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞": [
    { name: "–¢–µ–ª–µ—Ñ–æ–Ω", price: 1500 },
    { name: "–ù–∞—É—à–Ω–∏–∫", price: 200 },
    { name: "–ó–∞—Ä—è–¥–∫–∞", price: 80 }
  ],
  "–ö–∞–Ω—Å–µ–ª—è—Ä–∏—è": [
    { name: "“ö–∞–ª–∞–º", price: 10 },
    { name: "–î–∞—Ñ—Ç–∞—Ä", price: 20 },
    { name: "–°—É–º–∫–∞", price: 120 }
  ],
  "–õ–∏–±–æ—Å": [
    { name: "–§—É—Ç–±–æ–ª–∫–∞", price: 100 },
    { name: "–®–∏–º", price: 150 },
    { name: "–ö—É—Ä—Ç–∞", price: 300 }
  ]
};

let cart = [];

// === –ö–∞—Ç–µ–≥–æ—Ä–∏—è“≥–æ ===
function loadCategories() {
  const container = document.getElementById("categories");
  container.innerHTML = "";
  Object.keys(categories).forEach(cat => {
    container.innerHTML += `<div class="category" onclick="openCategory('${cat}')">${cat}</div>`;
  });
}

function openCategory(cat) {
  const list = document.getElementById("products");
  document.getElementById("categories").classList.add("hidden");
  list.classList.remove("hidden");

  list.innerHTML = `<h3>${cat}</h3>`;
  categories[cat].forEach(p => {
    list.innerHTML += `
      <div class="product">
        <b>${p.name}</b> ‚Äî ${p.price} —Å–æ–º–æ–Ω”£ 
        <button onclick="addToCart('${p.name}', ${p.price})">‚ûï –°–∞–±–∞–¥</button>
      </div>`;
  });
  list.innerHTML += `<br><button onclick="backToCategories()">‚¨ÖÔ∏è –ë–æ–∑–≥–∞—à—Ç</button>`;
}

function backToCategories() {
  document.getElementById("products").classList.add("hidden");
  document.getElementById("cart").classList.add("hidden");
  document.getElementById("admin").classList.add("hidden");
  document.getElementById("categories").classList.remove("hidden");
}

// === –°–∞–±–∞–¥ ===
function addToCart(name, price) {
  cart.push({ name, price });
  alert(name + " –±–∞ —Å–∞–±–∞–¥ –∏–ª–æ–≤–∞ —à—É–¥!");
}

function openCart() {
  document.getElementById("categories").classList.add("hidden");
  document.getElementById("products").classList.add("hidden");
  document.getElementById("admin").classList.add("hidden");
  document.getElementById("cart").classList.remove("hidden");
  updateCart();
}

function closeCart() {
  document.getElementById("cart").classList.add("hidden");
  document.getElementById("categories").classList.remove("hidden");
}

function updateCart() {
  const items = document.getElementById("cart-items");
  items.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    total += item.price;
    items.innerHTML += `<div class="cart-item">${item.name} ‚Äî ${item.price} —Å–æ–º–æ–Ω”£ 
      <button onclick="removeItem(${i})">‚ùå</button></div>`;
  });
  document.getElementById("total").innerText = total;
}

function removeItem(i) {
  cart.splice(i, 1);
  updateCart();
}

async function sendOrder() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const total = document.getElementById("total").innerText;

  if (!name || !phone || cart.length === 0) {
    alert("–õ—É—Ç—Ñ–∞–Ω –º–∞—ä–ª—É–º–æ—Ç—Ä–æ –ø—É—Ä—Ä–∞ –≤–æ—Ä–∏–¥ –Ω–∞–º–æ–µ–¥!"); 
    return;
  }

  const payload = {
    type: "order",
    customer: { name, phone, address },
    items: cart,
    total: Number(total),
    currency: "—Å–æ–º–æ–Ω”£"
  };

  try {
    await fetch(GAS_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload)
    });
    alert("‚úÖ –§–∞—Ä–º–æ–∏—à —Ñ–∏—Ä–∏—Å—Ç–æ–¥–∞ —à—É–¥!");
    cart = [];
    closeCart();
  } catch (e) {
    alert("‚ùå –•–∞—Ç–æ–≥”£: " + e.message);
  }
}

// === –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª ===
function openAdmin() {
  document.getElementById("categories").classList.add("hidden");
  document.getElementById("products").classList.add("hidden");
  document.getElementById("cart").classList.add("hidden");
  document.getElementById("admin").classList.remove("hidden");
}

async function addProduct() {
  const cat = document.getElementById("newCat").value.trim();
  const name = document.getElementById("newName").value.trim();
  const price = Number(document.getElementById("newPrice").value);

  if (!cat || !name || !price) {
    alert("‚ùó –õ—É—Ç—Ñ–∞–Ω “≥–∞–º–∞–∏ –º–∞–π–¥–æ–Ω“≥–æ—Ä–æ –ø—É—Ä –∫—É–Ω–µ–¥!"); 
    return;
  }

  const payload = {
    type: "addProduct",
    category: cat,
    name: name,
    price: price
  };

  try {
    await fetch(GAS_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(payload)
    });
    alert("‚úÖ –ú–æ–ª –±–∞ –±–∞–∑–∞ –∏–ª–æ–≤–∞ —à—É–¥!");
    document.getElementById("newCat").value = "";
    document.getElementById("newName").value = "";
    document.getElementById("newPrice").value = "";
    backToCategories();
  } catch (e) {
    alert("‚ùå –•–∞—Ç–æ–≥”£: " + e.message);
  }
}

loadCategories();
</script>
</body>
</html>
