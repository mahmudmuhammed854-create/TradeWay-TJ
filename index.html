<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TradeWay TJ</title>

<style>
body { margin:0; font-family:Arial; background:#f5f5f5; }

header {
  padding:15px;
  background:white;
  font-size:22px;
  font-weight:bold;
  text-align:center;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
}

.navbar {
  position:fixed;
  bottom:0;
  left:0; right:0;
  display:flex;
  justify-content:space-around;
  background:white;
  padding:10px 0;
  box-shadow:0 -2px 10px rgba(0,0,0,0.1);
}

.navbar div {
  text-align:center;
  font-size:14px;
  color:#444;
}

.section { display:none; padding:15px; }

.product {
  background:white;
  padding:10px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.product img {
  width:100%;
  border-radius:10px;
}

.btn {
  background:black;
  color:white;
  padding:10px;
  border-radius:10px;
  text-align:center;
  margin-top:10px;
}

.cart-item {
  background:white;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
}

.menu {
  position:fixed;
  left:-250px;
  top:0;
  bottom:0;
  width:250px;
  background:white;
  padding:20px;
  box-shadow:3px 0 10px rgba(0,0,0,0.2);
  transition:0.3s;
}

.menu.open { left:0; }

.menu-item {
  padding:10px 0;
  font-size:17px;
  border-bottom:1px solid #eee;
}
</style>
</head>

<body>

<header>
  <span onclick="openMenu()" style="float:left;font-size:26px;cursor:pointer;">‚ò∞</span>
  TRADEWAY TJ
</header>

<div class="menu" id="menu">
  <div class="menu-item" onclick="showSection('profile')">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
  <div class="menu-item" onclick="showSection('orders')">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</div>
  <div class="menu-item" onclick="showSection('catalog')">üõç –ö–∞—Ç–∞–ª–æ–≥</div>
  <div class="menu-item" onclick="window.location.href='https://t.me/tradewaytj'">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
  <div class="menu-item" onclick="logout()">üö™ –í—ã—Ö–æ–¥</div>
</div>

<!-- –ö–∞—Ç–∞–ª–æ–≥ -->
<div id="catalog" class="section" style="display:block;">
  <h2>–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h2>
  <div id="productList"></div>
</div>

<!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
<div id="cart" class="section">
  <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
  <div id="cartItems"></div>
  <div id="cartTotal"></div>
  <div class="btn" onclick="makeOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</div>
</div>

<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<div id="profile" class="section">
  <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>

  <label>–ò–º—è</label><br>
  <input id="pName" style="width:100%;padding:10px;"><br><br>

  <label>–¢–µ–ª–µ—Ñ–æ–Ω</label><br>
  <input id="pPhone" style="width:100%;padding:10px;"><br><br>

  <label>–ê–¥—Ä–µ—Å</label><br>
  <input id="pAddress" style="width:100%;padding:10px;"><br><br>

  <div class="btn" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</div>
</div>

<!-- –ó–∞–∫–∞–∑—ã -->
<div id="orders" class="section">
  <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
  <div id="orderList"></div>
</div>

<!-- –ù–∞–≤–±–∞—Ä -->
<div class="navbar">
  <div onclick="showSection('catalog')">üè†<br>–ì–ª–∞–≤–Ω–∞—è</div>
  <div onclick="showSection('cart')">üõí<br>–ö–æ—Ä–∑–∏–Ω–∞</div>
  <div onclick="showSection('orders')">üì¶<br>–ó–∞–∫–∞–∑—ã</div>
  <div onclick="showSection('profile')">üë§<br>–ü—Ä–æ—Ñ–∏–ª—å</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbysRicLQivawnpxC3LkdcJemDqSPW-RRDAT1dN9ZO5lxsMVcxGiKV7b_qZjYyBnqZpp/exec";

function openMenu(){ document.getElementById("menu").classList.add("open"); }
function closeMenu(){ document.getElementById("menu").classList.remove("open"); }
document.body.onclick = e => { if(e.target.id !== "menu") closeMenu(); };

function showSection(id){
  document.querySelectorAll(".section").forEach(s => s.style.display="none");
  document.getElementById(id).style.display="block";
}

const products = [
  {id:1, name:"–ë–∞–∑–æ–≤–∞—è –±–µ–ª–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞", price:6000, img:"https://picsum.photos/400"},
  {id:2, name:"–ë–∞–∑–æ–≤–∞—è –∑–µ–ª—ë–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞", price:6000, img:"https://picsum.photos/401"}
];

function renderProducts(){
  let html = "";
  products.forEach(p=>{
    html += `
      <div class="product">
        <img src="${p.img}">
        <h3>${p.name}</h3>
        <b>${p.price} —Å–æ–º–æ–Ω–∏</b>
        <div class="btn" onclick="addToCart(${p.id})">–í –∫–æ—Ä–∑–∏–Ω—É</div>
      </div>`;
  });
  document.getElementById("productList").innerHTML = html;
}
renderProducts();

let cart = JSON.parse(localStorage.getItem("cart") || "[]");

function addToCart(id){
  const item = products.find(p=>p.id===id);
  cart.push({...item, qty:1});
  localStorage.setItem("cart", JSON.stringify(cart));
  alert("–î–æ–±–∞–≤–ª–µ–Ω–æ!");
}

function renderCart(){
  let html="", sum=0;
  cart.forEach((p,i)=>{
    sum += p.price;
    html += `<div class="cart-item">
      ${p.name} ‚Äî ${p.price} —Å–æ–º–æ–Ω–∏
    </div>`;
  });
  document.getElementById("cartItems").innerHTML = html;
  document.getElementById("cartTotal").innerHTML = `<h3>–ò—Ç–æ–≥–æ: ${sum} —Å–æ–º–æ–Ω–∏</h3>`;
}
setInterval(renderCart,500);

function saveProfile(){
  const data = {
    name: pName.value,
    phone: pPhone.value,
    address: pAddress.value
  };
  localStorage.setItem("profile", JSON.stringify(data));
  alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
}

function loadProfile(){
  let p = JSON.parse(localStorage.getItem("profile") || "{}");
  pName.value = p.name || "";
  pPhone.value = p.phone || "";
  pAddress.value = p.address || "";
}
loadProfile();

function makeOrder(){
  let profile = JSON.parse(localStorage.getItem("profile")||"{}");
  if(!profile.name || !profile.phone){
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!");
    showSection("profile");
    return;
  }

  let total = cart.reduce((s,p)=>s+p.price,0);

  const payload = {
    action: "order",
    customer: profile,
    items: cart,
    total: total,
    currency: "—Å–æ–º–æ–Ω–∏"
  };

  fetch(SCRIPT_URL, {
    method:"POST",
    body:JSON.stringify(payload),
    headers:{ "Content-Type":"text/plain" }
  });

  let myOrders = JSON.parse(localStorage.getItem("orders")||"[]");
  myOrders.push({...payload, time:new Date().toLocaleString()});
  localStorage.setItem("orders", JSON.stringify(myOrders));

  cart = [];
  localStorage.setItem("cart", "[]");

  alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
  showSection("orders");
  renderOrders();
}

function renderOrders(){
  let list = JSON.parse(localStorage.getItem("orders")||"[]");
  let html="";
  list.forEach(o=>{
    html += `<div class="cart-item">
      <b>${o.time}</b><br>
      –°—É–º–º–∞: ${o.total} —Å–æ–º–æ–Ω–∏
    </div>`;
  });
  document.getElementById("orderList").innerHTML = html;
}
renderOrders();

function logout(){
  localStorage.clear();
  alert("–í—ã –≤—ã—à–ª–∏!");
  showSection("profile");
}
</script>

</body>
</html>
