<!DOCTYPE html>
<html lang="tg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeWay TJ</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
h1 { text-align: center; color: #333; }
.category, .cart, .admin { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 0 5px #ccc; margin-bottom: 20px; }
button { background: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; }
button:hover { background: #0056b3; }
.hidden { display: none; }
input[type="number"] { width: 70px; text-align: center; }
</style>
</head>
<body>

<h1>üõç TradeWay TJ</h1>

<div id="login">
  <h3>üîê –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
  <input type="password" id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å"><br><br>
  <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div id="adminPanel" class="admin hidden">
  <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
  <input type="text" id="newName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
  <input type="number" id="newPrice" placeholder="–¶–µ–Ω–∞">
  <button onclick="addProduct()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
  <h4>üìã –¢–æ–≤–∞—Ä—ã:</h4>
  <div id="productList"></div>
  <button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
</div>

<div id="shop" class="hidden">
  <div id="menu"></div>
  <button onclick="openCart()">üõí –ö–æ—Ä–∑–∏–Ω–∞</button>
</div>

<div id="cart" class="cart hidden">
  <h3>üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
  <div id="cart-items"></div>
  <p><b>–ò—Ç–æ–≥–æ:</b> <span id="total">0</span> —Å–æ–º–æ–Ω–∏</p>
  <input type="text" id="name" placeholder="–ò–º—è"><br><br>
  <input type="text" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"><br><br>
  <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å"><br><br>
  <button onclick="sendOrder()">üì¶ –¢–∞—Å–¥–∏“õ–∏ —Ñ–∞—Ä–º–æ–∏—à</button>
  <button onclick="closeCart()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbydkrOnh6EGUB89wrf3xo8y1hg_6nDJyOAwCCl4yFmk7ZtQFbBbv32C9APuSfJoyJGr/exec";
let cart = [];
let password = "";

// -------------------- –ó–ê–ì–†–£–ó–ö–ê –¢–û–í–ê–†–û–í --------------------
async function loadProducts() {
  const res = await fetch(GAS_URL);
  const data = await res.json();
  const menu = document.getElementById("menu");
  menu.innerHTML = "";
  data.forEach(p => {
    menu.innerHTML += `<div class='product'><b>${p.name}</b> ‚Äî ${p.price} —Å–æ–º <button onclick="addToCart('${p.name}', ${p.price})">‚ûï</button></div>`;
  });
}

// -------------------- –î–û–ë–ê–í–õ–ï–ù–ò–ï --------------------
async function addProduct() {
  const name = document.getElementById("newName").value.trim();
  const price = document.getElementById("newPrice").value;
  if (!name || !price) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É");

  await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ type: "addProduct", name, price, password })
  });
  alert("‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!");
  document.getElementById("newName").value = "";
  document.getElementById("newPrice").value = "";
  showProducts();
}

// -------------------- –ü–û–ö–ê–ó –°–ü–ò–°–ö–ê --------------------
async function showProducts() {
  const res = await fetch(GAS_URL);
  const data = await res.json();
  const list = document.getElementById("productList");
  list.innerHTML = "";
  data.forEach(p => {
    list.innerHTML += `
      <div>
        <input type="text" value="${p.name}" disabled>
        <input type="number" value="${p.price}" id="price-${p.name}">
        <button onclick="updatePrice('${p.name}')">üíæ</button>
        <button onclick="deleteProduct('${p.name}')">‚ùå</button>
      </div>`;
  });
}

// -------------------- –£–î–ê–õ–ï–ù–ò–ï --------------------
async function deleteProduct(name) {
  if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${name}?`)) return;
  await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ type: "deleteProduct", name, password })
  });
  showProducts();
}

// -------------------- –û–ë–ù–û–í–õ–ï–ù–ò–ï –¶–ï–ù–´ --------------------
async function updatePrice(name) {
  const newPrice = document.getElementById(`price-${name}`).value;
  await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ type: "deleteProduct", name, password })
  });
  await fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({ type: "addProduct", name, price: newPrice, password })
  });
  alert("üíæ –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");
  showProducts();
}

// -------------------- –ê–î–ú–ò–ù --------------------
function login() {
  const pass = document.getElementById("adminPass").value;
  if (pass === "admin123") {
    password = pass;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    showProducts();
  } else {
    alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
  }
}

function logout() {
  password = "";
  document.getElementById("adminPanel").classList.add("hidden");
  document.getElementById("login").classList.remove("hidden");
}

// -------------------- –ö–û–†–ó–ò–ù–ê --------------------
function openCart() {
  document.getElementById("cart").classList.remove("hidden");
  document.getElementById("shop").classList.add("hidden");
  updateCart();
}
function closeCart() {
  document.getElementById("cart").classList.add("hidden");
  document.getElementById("shop").classList.remove("hidden");
}
function addToCart(name, price) {
  cart.push({ name, price });
  alert(name + " –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!");
}
function updateCart() {
  const items = document.getElementById("cart-items");
  items.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    total += item.price;
    items.innerHTML += `<div>${item.name} ‚Äî ${item.price} —Å–æ–º <button onclick="removeItem(${i})">‚ùå</button></div>`;
  });
  document.getElementById("total").innerText = total;
}
function removeItem(i) {
  cart.splice(i, 1);
  updateCart();
}

// -------------------- –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê --------------------
async function sendOrder() {
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const address = document.getElementById("address").value;
  const total = document.getElementById("total").innerText;

  if (!name || !phone || cart.length === 0) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");

  await fetch(GAS_URL, {
    method: "POST",
    mode: "no-cors",
    body: JSON.stringify({
      type: "order",
      customer: { name, phone, address },
      items: cart,
      total,
      currency: "—Å–æ–º–æ–Ω–∏",
      ua: "TradeWayTJ"
    })
  });

  alert("‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
  cart = [];
  closeCart();
}

loadProducts();
</script>
</body>
</html>
