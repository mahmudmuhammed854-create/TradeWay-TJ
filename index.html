<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Demo Shop ‚Äî –ú–∏–Ω–∏‚Äë—à–∞–±–ª–æ–Ω</title>
  <meta name="description" content="–õ—ë–≥–∫–∏–π —à–∞–±–ª–æ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google Apps Script">
  <style>
    :root{
      --bg:#0f172a; --surface:#111827; --muted:#94a3b8; --text:#e5e7eb;
      --primary:#22c55e; --ring:rgba(34,197,94,.35); --card:#0b1220;
      --border:#1f2937; --danger:#ef4444; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#0b1022 40%,#0b0f1a);color:var(--text);font:16px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial}
    a{color:inherit}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* Header */
    header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(10px);background:rgba(10,14,25,.6);border-bottom:1px solid var(--border)}
    .nav{display:flex;align-items:center;gap:16px;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.5px}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:conic-gradient(var(--primary),#10b981)}
    .actions{display:flex;gap:10px;align-items:center}
    .input{display:flex;align-items:center;gap:8px;background:#0b1325;border:1px solid var(--border);border-radius:14px;padding:8px 12px;min-width:260px}
    .input input{all:unset;color:var(--text);width:100%}
    .btn{border:1px solid var(--border);background:#0c152a;padding:10px 14px;border-radius:14px;color:var(--text);cursor:pointer;transition:.2s ease;display:inline-flex;align-items:center;gap:8px}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .btn.primary{background:linear-gradient(180deg,#22c55e,#16a34a);border-color:#1a2c22;color:#04170b}

    /* Hero */
    .hero{padding:36px 0 8px}
    .hero .wrap{display:flex;gap:20px;align-items:center;justify-content:space-between}
    .title{font-size:28px;font-weight:800;line-height:1.2;margin:0}
    .subtitle{margin:6px 0 0;color:var(--muted)}

    /* Controls */
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin:16px 0}
    .select{appearance:none;background:#0b1325;border:1px solid var(--border);border-radius:12px;color:var(--text);padding:10px 12px}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:768px){.grid{grid-template-columns:repeat(2,1fr)}.input{min-width:unset;width:100%}}
    @media (max-width:480px){.grid{grid-template-columns:1fr}}

    /* Card */
    .card{background:linear-gradient(180deg,#0a1220,var(--card));border:1px solid var(--border);border-radius:18px;overflow:hidden;display:flex;flex-direction:column;min-height:100%}
    .thumb{aspect-ratio:4/3;background:#0a0e18;position:relative;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .35s ease}
    .card:hover .thumb img{transform:scale(1.05)}
    .badge{position:absolute;left:10px;top:10px;background:rgba(34,197,94,.1);color:#a7f3d0;border:1px solid #065f46;padding:4px 8px;border-radius:999px;font-size:12px}
    .body{padding:14px;display:flex;flex-direction:column;gap:10px}
    .name{font-weight:700}
    .price{display:flex;align-items:baseline;gap:8px}
    .price .new{font-size:18px;font-weight:800;color:#bbf7d0}
    .price .old{text-decoration:line-through;color:#64748b}
    .meta{color:var(--muted);font-size:13px}
    .qty{display:flex;gap:8px;align-items:center}
    .qty button{width:30px;height:30px;border-radius:10px;border:1px solid var(--border);background:#0c152a;color:var(--text);cursor:pointer}
    .add{margin-top:auto}

    /* Cart panel */
    .cart-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:none;z-index:60}
    .cart{position:fixed;right:0;top:0;height:100dvh;width:380px;max-width:100%;background:#0b1325;border-left:1px solid var(--border);box-shadow:-10px 0 30px rgba(0,0,0,.3);transform:translateX(105%);transition:transform .25s ease;z-index:61;display:flex;flex-direction:column}
    .cart.open{transform:translateX(0)}
    .cart-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .cart-items{padding:10px 12px;overflow:auto;flex:1}
    .cart-row{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;padding:10px;border:1px solid var(--border);border-radius:12px;background:#0a1324;margin-bottom:10px}
    .cart-row img{width:64px;height:64px;object-fit:cover;border-radius:10px}
    .cart-row .row-title{font-weight:700}
    .cart-row .row-meta{color:var(--muted);font-size:12px}
    .cart-row .row-actions{display:flex;gap:8px;align-items:center}
    .cart-footer{border-top:1px solid var(--border);padding:12px 16px;display:grid;gap:10px}
    .total{display:flex;align-items:center;justify-content:space-between;font-weight:800}
    .danger{background:linear-gradient(180deg,var(--danger),#b91c1c);border-color:#7f1d1d;color:#fff}
  </style>
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
      <div class="brand" aria-label="Demo Shop">
        <span class="dot" aria-hidden="true"></span>
        <span>Demo Shop</span>
      </div>
      <div class="input" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-3.5-3.5" stroke="#64748b" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#64748b" stroke-width="2"/></svg>
        <input id="q" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤‚Ä¶ (–Ω–∞–ø—Ä–∏–º–µ—Ä, watch)" aria-label="–ü–æ–∏—Å–∫" />
      </div>
      <div class="actions">
        <select id="sort" class="select" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
          <option value="popular">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</option>
          <option value="price_asc">–¶–µ–Ω–∞: –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
          <option value="price_desc">–¶–µ–Ω–∞: –ø–æ —É–±—ã–≤–∞–Ω–∏—é</option>
        </select>
        <button id="openCart" class="btn" aria-haspopup="dialog" aria-controls="cartPanel" aria-expanded="false">üõí –ö–æ—Ä–∑–∏–Ω–∞ <span id="cartCount" aria-live="polite" style="margin-left:6px;opacity:.7">0</span></button>
        <button id="cta" class="btn primary">–ö–∞—Ç–∞–ª–æ–≥</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="wrap">
        <div>
          <h1 class="title">–õ—ë–≥–∫–∏–π —Å—Ç–∞—Ä—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω–∞</h1>
          <p class="subtitle">–ß–∏—Å—Ç—ã–π HTML/CSS/JS, –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤, —Ñ–∏–ª—å—Ç—Ä/—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –∫–æ—Ä–∑–∏–Ω–∞ —Å –ø–æ–¥—Å—á—ë—Ç–æ–º —Å—É–º–º—ã.</p>
        </div>
      </div>
      <div class="controls" aria-label="–§–∏–ª—å—Ç—Ä—ã">
        <button class="btn" data-filter="all">–í—Å–µ</button>
        <button class="btn" data-filter="wear">–û–¥–µ–∂–¥–∞</button>
        <button class="btn" data-filter="tech">–¢–µ—Ö–Ω–∏–∫–∞</button>
        <button class="btn" data-filter="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
      </div>
    </section>

    <section aria-label="–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤">
      <div id="grid" class="grid"></div>
    </section>
  </main>

  <!-- Overlay + Cart Panel -->
  <div id="overlay" class="cart-overlay" aria-hidden="true"></div>
  <aside id="cartPanel" class="cart" role="dialog" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
    <div class="cart-header">
      <strong>–ö–æ—Ä–∑–∏–Ω–∞</strong>
      <button id="closeCart" class="btn">‚úï</button>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer">
      <div class="total">–ò—Ç–æ–≥–æ: <span id="cartTotal">0 ‚ÇΩ</span></div>
      <button id="checkout" class="btn primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é</button>
      <button id="clear" class="btn danger">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
      <small style="color:var(--muted)">* –í –¥–µ–º–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ ‚Äî –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –≤–∞—à –±—ç–∫–µ–Ω–¥/–ø–ª–∞—Ç—ë–∂–Ω—ã–π —à–ª—é–∑.</small>
    </div>
  </aside>

  <script>
    // ======= Google Apps Script –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è =======
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzdTlOP4ZsnzUT9mVddBtV5uqef_t6fq9jaAf_b6nBhio7eKR_g3dH3wnkUfQweh59j/exec';

    async function sendOrder(cart){
      try{
        const items = Array.from(cart.values()).map(({product, qty})=>({ id: product.id, name: product.name, price: product.price, qty }));
        const res = await fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ action:'order', items }) });
        // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –Ω–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª —Ç–µ–∫—Å—Ç ‚Äî –æ—Ç–æ–±—Ä–∞–∑–∏–º –µ–≥–æ –∫–∞–∫ –µ—Å—Ç—å
        let data; try { data = await res.json(); } catch{ data = await res.text(); }
        alert('‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:\n' + (typeof data==='string'?data:JSON.stringify(data)));
      }catch(err){ alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞: ' + err.message); }
    }

    // ======= –î–ê–ù–ù–´–ï –¢–û–í–ê–†–û–í =======
    const products = [
      {id:1, name:'Minimal Watch', price:4990, oldPrice:6990, tag:'accessories', rating:4.6, img:'https://picsum.photos/seed/watch/800/600'},
      {id:2, name:'Noise‚ÄëCancel Headphones', price:12990, oldPrice:14990, tag:'tech', rating:4.8, img:'https://picsum.photos/seed/headphones/800/600'},
      {id:3, name:'Running Sneakers', price:6990, tag:'wear', rating:4.4, img:'https://picsum.photos/seed/sneakers/800/600'},
      {id:4, name:'Smartphone Lite', price:19990, oldPrice:22990, tag:'tech', rating:4.7, img:'https://picsum.photos/seed/phone/800/600'},
      {id:5, name:'Leather Backpack', price:8990, tag:'accessories', rating:4.5, img:'https://picsum.photos/seed/backpack/800/600'},
      {id:6, name:'Cotton T‚ÄëShirt', price:1590, tag:'wear', rating:4.3, img:'https://picsum.photos/seed/tshirt/800/600'},
      {id:7, name:'Wireless Charger', price:2490, tag:'tech', rating:4.1, img:'https://picsum.photos/seed/charger/800/600'},
      {id:8, name:'Sunglasses', price:2790, tag:'accessories', rating:4.2, img:'https://picsum.photos/seed/sunglasses/800/600'}
    ];

    // ======= –°–û–°–¢–û–Ø–ù–ò–ï/–£–¢–ò–õ–ò–¢–´ =======
    const state = { filter:'all', sort:'popular', q:'', cart: new Map() };
    const fmt = n => n.toLocaleString('ru-RU');
    const el = (tag, attrs={}, ...children) => {
      const node = document.createElement(tag);
      Object.entries(attrs).forEach(([k,v]) => {
        if(k.startsWith('on') && typeof v === 'function') node.addEventListener(k.slice(2), v);
        else if(v !== false && v != null) node.setAttribute(k, v===true ? '' : v);
      });
      children.flat().forEach(c => node.append(c instanceof Node ? c : document.createTextNode(c)));
      return node;
    };

    // ======= –†–ï–ù–î–ï–† –°–ï–¢–ö–ò =======
    const grid = document.getElementById('grid');
    function renderGrid(){
      grid.innerHTML='';
      let list = products.filter(p => state.filter==='all' ? true : p.tag===state.filter);
      if(state.q){ const q = state.q.toLowerCase(); list = list.filter(p => p.name.toLowerCase().includes(q)); }
      if(state.sort==='price_asc') list.sort((a,b)=>a.price-b.price);
      if(state.sort==='price_desc') list.sort((a,b)=>b.price-a.price);
      if(state.sort==='popular') list.sort((a,b)=>b.rating-a.rating);
      list.forEach(p => grid.append(card(p)));
      if(!list.length) grid.append(el('p',{style:'opacity:.75'},'–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.'));
    }

    function card(p){
      const badge = p.oldPrice ? el('span',{class:'badge'},'‚àí', Math.round((1-p.price/p.oldPrice)*100),'%') : '';
      return el('article',{class:'card', tabindex:'0', 'aria-label':p.name},
        el('div',{class:'thumb'}, el('img',{src:p.img, alt:p.name, loading:'lazy'}), badge),
        el('div',{class:'body'},
          el('div',{class:'name'}, p.name),
          el('div',{class:'meta'}, '–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ', p.tag, ' ¬∑ ‚òÖ ', p.rating),
          el('div',{class:'price'}, el('span',{class:'new'}, fmt(p.price),' ‚ÇΩ'), p.oldPrice ? el('span',{class:'old'}, fmt(p.oldPrice),' ‚ÇΩ') : ''),
          el('div',{class:'qty','aria-label':'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'},
            el('button',{onclick:()=>updateCart(p,-1)}, '‚àí'),
            el('span',{id:`qty-${p.id}`,'aria-live':'polite'}, getQty(p.id)),
            el('button',{onclick:()=>updateCart(p,1)}, '+')
          ),
          el('button',{class:'btn add',onclick:()=>updateCart(p,1)}, '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É')
        )
      );
    }

    function getQty(id){ return state.cart.get(id)?.qty || 0; }

    // ======= –ö–û–†–ó–ò–ù–ê =======
    const cartPanel = document.getElementById('cartPanel');
    const overlay = document.getElementById('overlay');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const cartCount = document.getElementById('cartCount');

    function openCart(){ cartPanel.classList.add('open'); overlay.style.display='block'; document.getElementById('openCart').setAttribute('aria-expanded','true'); }
    function closeCart(){ cartPanel.classList.remove('open'); overlay.style.display='none'; document.getElementById('openCart').setAttribute('aria-expanded','false'); }

    function updateCart(product, delta){
      const item = state.cart.get(product.id) || {product, qty:0};
      item.qty = Math.max(0, item.qty + delta);
      if(item.qty===0) state.cart.delete(product.id); else state.cart.set(product.id, item);
      const qtyNode = document.getElementById(`qty-${product.id}`); if(qtyNode) qtyNode.textContent = getQty(product.id);
      renderCart();
    }

    function renderCart(){
      cartItems.innerHTML=''; let total = 0, count = 0;
      for(const {product, qty} of state.cart.values()){
        const line = product.price * qty; total += line; count += qty;
        cartItems.append(el('div',{class:'cart-row'},
          el('img',{src:product.img, alt:product.name}),
          el('div',{}, el('div',{class:'row-title'}, product.name), el('div',{class:'row-meta'}, `${fmt(product.price)} ‚ÇΩ √ó ${qty} = ${fmt(line)} ‚ÇΩ`)),
          el('div',{class:'row-actions'},
            el('button',{onclick:()=>updateCart(product,-1)}, '‚àí'),
            el('span',{}, qty),
            el('button',{onclick:()=>updateCart(product,1)}, '+'),
            el('button',{class:'btn',onclick:()=>{state.cart.delete(product.id); renderCart();}}, '–£–¥–∞–ª–∏—Ç—å')
          )
        ));
      }
      if(state.cart.size===0){ cartItems.append(el('p',{style:'opacity:.75'},'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.')); }
      cartTotal.textContent = fmt(total) + ' ‚ÇΩ'; cartCount.textContent = count;
    }

    // ======= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ë–ï–ó–û–ü–ê–°–ù–û–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –°–õ–£–®–ê–¢–ï–õ–ï–ô =======
    function safeOn(id, type, handler){ const n = document.getElementById(id); if(!n){ console.warn(`[init] —É–∑–µ–ª #${id} –Ω–µ –Ω–∞–π–¥–µ–Ω`); return; } n.addEventListener(type, handler); }

    function init(){
      renderGrid();
      renderCart();
      safeOn('openCart','click', openCart);
      safeOn('closeCart','click', closeCart);
      overlay.addEventListener('click', closeCart);
      safeOn('clear','click', ()=>{state.cart.clear(); renderCart(); renderGrid();});
      safeOn('checkout','click', ()=>{
        if(state.cart.size===0){ alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞'); return; }
        sendOrder(state.cart);
      });
      const sort = document.getElementById('sort'); if(sort) sort.addEventListener('change', e=>{ state.sort = e.target.value; renderGrid(); });
      const q = document.getElementById('q'); if(q) q.addEventListener('input', e=>{ state.q = e.target.value; renderGrid(); });
      document.querySelectorAll('[data-filter]').forEach(b=>b.addEventListener('click',()=>{ state.filter = b.getAttribute('data-filter'); renderGrid(); }));
    }

    // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ DOM –≥–æ—Ç–æ–≤ –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–º–µ—Å—Ç—è—Ç –≤ <head>
    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();

    // ======= –ü–†–û–°–¢–ï–ô–®–ò–ï ¬´–¢–ï–°–¢–´¬ª (–Ω–µ –ª–æ–º–∞—é—Ç —Ä–∞–±–æ—Ç—É) =======
    ;(function smokeTests(){
      const tests = [];
      const a = (name, fn)=>{ try{ fn(); console.info('‚úÖ', name); tests.push({name, ok:true}); } catch(e){ console.error('‚ùå', name, e); tests.push({name, ok:false, e}); } };
      a('–≠–ª–µ–º–µ–Ω—Ç #checkout —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', ()=>{ if(!document.getElementById('checkout')) throw new Error('#checkout not found'); });
      a('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫', ()=>{
        const before = Number(document.getElementById('cartCount').textContent)||0;
        updateCart(products[0], +1);
        const after = Number(document.getElementById('cartCount').textContent)||0;
        if(!(after>before)) throw new Error('cartCount not increased');
      });
      // –ù–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏–º —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å: –ø—Ä–æ—Å—Ç–æ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ sendOrder ‚Äî —Ñ—É–Ω–∫—Ü–∏—è
      a('–§—É–Ω–∫—Ü–∏—è sendOrder –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞', ()=>{ if(typeof sendOrder!== 'function') throw new Error('sendOrder missing'); });
      // –í—ã–≤–æ–¥–∏–º –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç
      console.table(tests.map(t=>({test:t.name, ok:t.ok})));
    })();
  </script>
</body>
</html>
