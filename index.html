<!DOCTYPE html>
<html lang="tg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeWay TJ ‚Äî –î”Ø–∫–æ–Ω</title>
<style>
  :root{--bg:#0f1115;--panel:#151821;--card:#191d27;--border:#232836;--text:#e8ecf1;--muted:#9aa0b4;--accent:#4cc9f0}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui}
  header{position:sticky;top:0;z-index:5;border-bottom:1px solid var(--border);background:linear-gradient(180deg,var(--bg),rgba(15,17,21,.85));backdrop-filter:blur(6px)}
  .wrap{max-width:1000px;margin:0 auto;padding:12px 16px}
  .bar{display:flex;gap:12px;align-items:center;justify-content:space-between}
  h1{margin:0;font-size:18px}
  .search{display:flex;gap:8px;flex:1;max-width:460px;margin:0 12px}
  .input{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px 12px;color:var(--text);width:100%}
  .btn{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;transition:.2s}
  .btn:hover{background:var(--card)}
  .btn.acc{background:linear-gradient(135deg,#38bdf8,#22d3ee);border:none;color:#081018}
  main .wrap{display:grid;grid-template-columns:230px 1fr;gap:16px}
  .sidebar{align-self:start;position:sticky;top:64px;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
  .cat{width:100%;text-align:left;margin-bottom:8px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px}
  .cat.active{outline:2px solid var(--accent);border-color:transparent}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
  .thumb{aspect-ratio:16/11;background:#0b0d12;display:flex;align-items:center;justify-content:center;color:#888}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .body{padding:12px;display:flex;flex-direction:column;gap:8px}
  .row{display:flex;gap:8px;align-items:center}
  .row.push{justify-content:space-between;margin-top:auto}
  .price{font-weight:700}
  .drawer{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:50}
  .drawer.show{display:block}
  .panel{position:absolute;right:0;top:0;height:100%;width:420px;max-width:100%;background:var(--panel);border-left:1px solid var(--border);padding:16px;overflow:auto}
  .muted{color:var(--muted);font-size:12px}
  .close-x{position:absolute;top:8px;right:12px;font-size:22px;color:var(--muted);cursor:pointer}
  .close-x:hover{color:var(--accent)}
</style>
</head>
<body>
<header>
  <div class="wrap bar">
    <h1>TradeWay TJ ‚Äî –î”Ø–∫–æ–Ω</h1>
    <div class="search">
      <input id="q" class="input" placeholder="“∂—É—Å—Ç—É“∑”Ø‚Ä¶">
      <button class="btn" id="clearQ">–¢–æ–∑–∞</button>
    </div>
    <div class="row" style="gap:8px">
      <button class="btn" id="openCart">üõí –°–∞–±–∞–¥</button>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <aside class="sidebar" id="cats"></aside>
    <section>
      <div class="grid" id="grid"></div>
    </section>
  </div>
</main>

<!-- –ö–û–†–ó–ò–ù–ê -->
<div class="drawer" id="drawer">
  <div class="panel">
    <span class="close-x" id="closeX">‚úñ</span>
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
      <button class="btn" id="backToShop">‚Üê –ë–∞ –º–µ–Ω—é</button>
    </div>

    <h3 style="margin:8px 0 12px">üßæ –°–∞–±–∞–¥</h3>
    <div id="cartList"></div>

    <div class="row" style="justify-content:space-between;margin-top:12px">
      <b>“∂–∞–º—ä:</b> <span id="totalPrice">0 —Å–æ–º–æ–Ω”£</span>
    </div>

    <h4 style="margin-top:16px">–ú–∞—ä–ª—É–º–æ—Ç–∏ –º—É—à—Ç–∞—Ä”£</h4>
    <div class="row" style="flex-direction:column;align-items:stretch;gap:8px">
      <input id="custName" class="input" placeholder="–ù–æ–º">
      <input id="custPhone" class="input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
      <textarea id="custAddr" class="input" rows="3" placeholder="–°—É—Ä–æ“ì–∞"></textarea>
      <button class="btn acc" id="placeOrder">üì¶ –¢–∞—Å–¥–∏“õ–∏ —Ñ–∞—Ä–º–æ–∏—à</button>
      <div class="muted">–ü–∞—Å –∞–∑ —Ç–∞—Å–¥–∏“õ —Ñ–∞—Ä–º–æ–∏—à –±–∞ Google –¢–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç”£ —Å–∞–±—Ç –º–µ—à–∞–≤–∞–¥.</div>
      <div id="status" class="muted"></div>
    </div>
  </div>
</div>

<script>
// ========= –ù–ê–°–¢–†–û–ô–ö–ò =========
const CURRENCY = "—Å–æ–º–æ–Ω”£";
const GAS_URL = "https://script.google.com/macros/s/AKfycbxEeYBEWhVm8yrru9A96C21ZOxZMfsgag0JBNDZImUuW1DPSYj4iJrZ9Js6D3F8ebT8/exec";

const categories = [
  {id:"electronic", name:"üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞"},
  {id:"office",     name:"‚úèÔ∏è –ö–∞–Ω—Å–µ–ª—è—Ä–∏—è"},
  {id:"clothes",    name:"üëï –õ–∏–±–æ—Å"},
  {id:"shoes",      name:"üëü –ü–æ–π–∞—Ñ–∑–æ–ª"},
  {id:"bed",        name:"üõè –ü–æ—Å—Ç–µ–ª–Ω–æ–µ –±–µ–ª—ä–µ"},
  {id:"perfume",    name:"üå∏ –ê—Ç—Ä"}
];

const products = [
  {id:101, cat:"electronic", name:"–¢–µ–ª–µ—Ñ–æ–Ω–∏ A12", price:2499, img:"https://picsum.photos/seed/phone/480/330"},
  {id:102, cat:"electronic", name:"–ì”Ø—à–º–æ–Ω–∞–∫–∏ Pro ANC", price:799, img:"https://picsum.photos/seed/headset/480/330"},
  {id:201, cat:"office", name:"–î–∞—Ñ—Ç–∞—Ä 96 —Å–∞“≥–∏—Ñ–∞", price:12, img:"https://picsum.photos/seed/notebook/480/330"},
  {id:202, cat:"office", name:"“ö–∞–ª–∞–º –≥–µ–ª”£", price:6, img:"https://picsum.photos/seed/pen/480/330"},
  {id:301, cat:"clothes", name:"–§—É—Ç–±–æ–ª–∫–∞ TradeWay", price:149, img:"https://picsum.photos/seed/shirt/480/330"},
  {id:302, cat:"clothes", name:"“∂–æ–º–∞–∏ –≥–∞—Ä–º", price:379, img:"https://picsum.photos/seed/hoodie/480/330"},
  {id:401, cat:"shoes", name:"–ö—Ä–æ—Å—Å–æ–≤–∫–∞–∏ —Å–∞—Ñ–µ–¥", price:499, img:"https://picsum.photos/seed/shoes/480/330"},
  {id:501, cat:"bed", name:"–ë–æ–ª–∏—à—Ç–∏ –æ—Ä—Ç–æ–ø–µ–¥”£", price:219, img:"https://picsum.photos/seed/pillow/480/330"},
  {id:502, cat:"bed", name:"–ü”Ø—Å—Ç–∏ –Ω–∞—Ä–º", price:179, img:"https://picsum.photos/seed/plaid/480/330"},
  {id:601, cat:"perfume", name:"–ê—Ç—Ä–∏ Classic 50–º–ª", price:589, img:"https://picsum.photos/seed/perfume/480/330"}
];

const state = { activeCat: "all", query: "", cart: [] };
const $ = s => document.querySelector(s);
const fmt = n => `${Number(n||0).toLocaleString('ru-RU')} ${CURRENCY}`;
const findP = id => products.find(p=>p.id===id);

function renderCats() {
  const catsEl = $("#cats");
  catsEl.innerHTML = "";
  const all = document.createElement("button");
  all.className = "cat" + (state.activeCat==="all"?" active":"");
  all.textContent = "üì¶ “≤–∞–º–∞ –º–∞“≥—Å—É–ª–æ—Ç";
  all.onclick = ()=>{ state.activeCat="all"; renderGrid(); };
  catsEl.appendChild(all);

  categories.forEach(c=>{
    const b = document.createElement("button");
    b.className = "cat" + (state.activeCat===c.id?" active":"");
    b.textContent = c.name;
    b.onclick = ()=>{ state.activeCat=c.id; renderGrid(); };
    catsEl.appendChild(b);
  });
}

function renderGrid(){
  let list = products;
  if(state.activeCat!=="all") list = list.filter(p=>p.cat===state.activeCat);
  if(state.query) list = list.filter(p=>p.name.toLowerCase().includes(state.query.toLowerCase()));
  const gridEl = $("#grid");
  gridEl.innerHTML = list.map(p=>{
    const qty = state.cart.find(i=>i.id===p.id)?.qty || 0;
    return `
      <div class="card">
        <div class="thumb">${p.img?`<img src="${p.img}" alt="">`:"–∞–∫—Å –Ω–µ—Å—Ç"}</div>
        <div class="body">
          <div><b>${p.name}</b></div>
          <div class="row"><span class="price">${fmt(p.price)}</span></div>
          <div class="row push">
            <div class="row" style="gap:6px">
              <button class="btn" onclick="dec(${p.id})">‚àí</button>
              <div>${qty}</div>
              <button class="btn" onclick="inc(${p.id})">+</button>
            </div>
            <button class="btn" onclick="add(${p.id})">–ë–∞ —Å–∞–±–∞–¥</button>
          </div>
        </div>
      </div>`;
  }).join("") || `<div class="muted">–ú–∞“≥—Å—É–ª–æ—Ç —ë—Ñ—Ç –Ω–∞—à—É–¥.</div>`;
}

function inc(id){ const r=state.cart.find(i=>i.id===id); if(r) r.qty++; else state.cart.push({id,qty:1}); if(drawerOpen()) renderCart(); renderGrid(); }
function dec(id){ const r=state.cart.find(i=>i.id===id); if(!r) return; r.qty--; if(r.qty<=0) state.cart=state.cart.filter(i=>i.id!==id); if(drawerOpen()) renderCart(); renderGrid(); }
function add(id){ inc(id); }
function removeItem(id){ state.cart=state.cart.filter(i=>i.id!==id); renderCart(); renderGrid(); }

function totals(){let sum=0; state.cart.forEach(i=>{ const p=findP(i.id); if(p) sum+=p.price*i.qty; }); return {sum};}

const drawerEl = $("#drawer");
function drawerOpen(){ return drawerEl.classList.contains("show"); }
$("#openCart").onclick = ()=>{ drawerEl.classList.add("show"); document.body.style.overflow="hidden"; renderCart(); };
function closeDrawer(){ drawerEl.classList.remove("show"); document.body.style.overflow=""; }
$("#closeX").onclick = closeDrawer;
$("#backToShop").onclick = closeDrawer;

function renderCart(){
  const list = $("#cartList"); const t = totals();
  if(state.cart.length===0){ list.innerHTML = `<div class="muted">–°–∞–±–∞–¥ —Ö–æ–ª”£ –∞—Å—Ç.</div>`; $("#totalPrice").textContent = fmt(0); return; }
  list.innerHTML = state.cart.map(i=>{
    const p=findP(i.id); const sub=(p?.price||0)*i.qty;
    return `
      <div class="row" style="justify-content:space-between;border-bottom:1px dashed var(--border);padding:8px 0">
        <div style="flex:1">
          <div><b>${p?.name||"–Ω–µ—Å—Ç"}</b></div>
          <div class="row" style="gap:6px;margin-top:6px">
            <button class="btn" onclick="dec(${i.id})">‚àí</button>
            <div>${i.qty}</div>
            <button class="btn" onclick="inc(${i.id})">+</button>
            <button class="btn" onclick="removeItem(${i.id})">–ù–µ—Å—Ç –∫–∞—Ä–¥–∞–Ω</button>
          </div>
        </div>
        <div class="price">${fmt(sub)}</div>
      </div>`;
  }).join("");
  $("#totalPrice").textContent = fmt(t.sum);
}

// === –ü–û–ò–°–ö ===
$("#q").addEventListener("input", e=>{
  state.query = e.target.value.trim();
  renderGrid();
});
$("#clearQ").onclick = ()=>{
  $("#q").value = "";
  state.query = "";
  renderGrid();
};

// === –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ===
$("#placeOrder").onclick = async ()=>{
  const status = $("#status");
  const order = {
    currency: CURRENCY,
    customer: {
      name: $("#custName").value.trim(),
      phone: $("#custPhone").value.trim(),
      address: $("#custAddr").value.trim(),
    },
    items: state.cart.map(i=>{
      const p=findP(i.id);
      return { id:i.id, name:p?.name||"", qty:i.qty, price:p?.price||0, subtotal:(p?.price||0)*i.qty }
    }),
    total: totals().sum
  };
  if(!order.customer.name || !order.customer.phone){ status.textContent="‚ùó–õ—É—Ç—Ñ–∞–Ω –Ω–æ–º –≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—Ä–æ –≤–æ—Ä–∏–¥ –∫—É–Ω–µ–¥."; return; }
  if(order.items.length===0){ status.textContent="‚ùó–°–∞–±–∞–¥ —Ö–æ–ª”£ –∞—Å—Ç."; return; }
  status.textContent="‚è≥ –ò—Ä—Å–æ–ª –±–∞ Google Sheets...";
  try{
    const res=await fetch(GAS_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(order)});
    const data=await res.json();
    if(data.ok){ status.textContent="‚úÖ –§–∞—Ä–º–æ–∏—à —Å–∞–±—Ç —à—É–¥!"; state.cart=[]; renderCart(); renderGrid();}
    else{ status.textContent="‚ùå –•–∞—Ç–æ–≥”£: "+(data.error||""); }
  }catch(err){ status.textContent="‚ùå –•–∞—Ç–æ–≥”£ –ø–∞–π–≤–∞—Å—Ç—à–∞–≤”£: "+err.message; }
};

renderCats();
renderGrid();
window.inc=inc; window.dec=dec; window.add=add; window.removeItem=removeItem;
</script>
</body>
</html>
